<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="luz">
<title>Training a causal language model from scratch • luz</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Training a causal language model from scratch">
<meta property="og:description" content="luz">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">luz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Using luz</h6>
    <a class="dropdown-item" href="../../articles/get-started.html">Get started</a>
    <a class="dropdown-item" href="../../articles/custom-loop.html">Custom loops</a>
    <a class="dropdown-item" href="../../articles/accelerator.html">Accelerator API</a>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../../articles/lr-finder.html">Using the lr_finder</a>
    <a class="dropdown-item" href="../../articles/checkpoints.html">Checkpoints models</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../../articles/examples/index.html">Examples</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlverse/luz/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Training a causal language model from scratch</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlverse/luz/blob/HEAD/vignettes/examples/text-generation.Rmd" class="external-link"><code>vignettes/examples/text-generation.Rmd</code></a></small>
      <div class="d-none name"><code>text-generation.Rmd</code></div>
    </div>

    
    
<p>This example is an adaptation of the ‘Training a causal language
model from scratch’ class from the <a href="https://huggingface.co/learn/nlp-course/chapter7/6?fw=pt" class="external-link">Hugging
Face NLP course</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlverse/tok" class="external-link">tok</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlverse.github.io/luz/" class="external-link">luz</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">minhub</span><span class="op">)</span> <span class="co"># remotes::install_github("mlverse/minhub")</span></span>
<span><span class="co">#library(tidyverse)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>arrow.skip_nul <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>First step is to implement a torch dataset that gathers data and
pre-process it into a format that is suitable for training the
model.</p>
<p>That means that we need to:</p>
<ol style="list-style-type: decimal">
<li>Download data</li>
<li>Train a tokenizer for this dataset</li>
<li>Be able to produce sequences of tokens in the format expected by the
model</li>
</ol>
<p>We are going to use 2 datasets available in Hugging Face Hub. The
first contain all R packages source code available on CRAN. The second
contains all R code that is available in GitHub data dumps. Both
datasets are in the Parquet format. Following we implement a function
that downloads and caches the data and then returns a single arrow table
containing all data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_dataset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">source</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">hfhub</span><span class="fu">::</span><span class="fu">hub_snapshot</span><span class="op">(</span>repo_type <span class="op">=</span> <span class="st">"dataset"</span>, allow_patterns <span class="op">=</span> <span class="st">"parquet$"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"data/r"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu">open_dataset</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">".*\\.[rR]$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>content <span class="op">=</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu">cast</span><span class="op">(</span><span class="va">content</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="fu">string</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># the dataset contains invalid utf8 characters...</span></span>
<span>    <span class="co"># we need to remove them, otherwise we get an error from tokenizers</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">utf8</span><span class="fu">::</span><span class="fu"><a href="https://ptrckprry.com/r-utf8/reference/as_utf8.html" class="external-link">utf8_valid</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">read_datasets</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu">read_dataset</span><span class="op">(</span><span class="st">"dfalbel/cran-packages"</span><span class="op">)</span>,</span>
<span>    <span class="fu">read_dataset</span><span class="op">(</span><span class="st">"dfalbel/github-r-repos"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next we implement a function that trains a tokenizer for our
dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">create_tokenizer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">vocab_size</span>, <span class="va">special_tokens</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">tokenizer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu">tok</span><span class="fu">::</span><span class="va">model_bpe</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tok</span><span class="op">$</span><span class="va">pre_tokenizer</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">pre_tokenizer_byte_level</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>add_prefix_space <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">tok</span><span class="op">$</span><span class="va">decoder</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">decoder_byte_level</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tok</span><span class="op">$</span><span class="va">post_processor</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">processor_byte_level</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>trim_offsets <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tok</span><span class="op">$</span><span class="fu">train_from_memory</span><span class="op">(</span></span>
<span>    <span class="va">text</span>,</span>
<span>    <span class="fu">tok</span><span class="fu">::</span><span class="va">trainer_bpe</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>vocab_size <span class="op">=</span> <span class="va">vocab_size</span>, special_tokens <span class="op">=</span> <span class="va">special_tokens</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">tok</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># test code to debug the tokenizer</span></span>
<span><span class="co"># data &lt;- read_datasets()</span></span>
<span><span class="co"># tok &lt;- create_tokenizer(data$content)</span></span></code></pre></div>
<p>We can finally implement the torch dataset that we are going to use
for training the model. We are going to use the
<code><a href="https://rdrr.io/pkg/torch/man/iterable_dataset.html" class="external-link">torch::iterable_dataset</a></code> instead of
<code><a href="https://rdrr.io/pkg/torch/man/dataset.html" class="external-link">torch::dataset</a></code>. The main motivation is that we can’t really
know the total number of samples in the dataset, so we can implement a
<code>.getitem()</code> method to get any arbiratrary sample. Thus we
implement the <code>.iter</code> method that returns a new sample every
time it’s called.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_sources_dataset</span> <span class="op">&lt;-</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/iterable_dataset.html" class="external-link">iterable_dataset</a></span><span class="op">(</span></span>
<span>  <span class="st">"r_sources_dataset"</span>,</span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">root</span> <span class="op">=</span> <span class="st">"."</span>, <span class="va">vocab_size</span> <span class="op">=</span> <span class="fl">20000</span>, <span class="va">context_length</span> <span class="op">=</span> <span class="fl">128</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_datasets</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">context_length</span> <span class="op">&lt;-</span> <span class="va">context_length</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># we only create a tokenizer if it doesn't exist, otherwise we just load it</span></span>
<span>    <span class="va">tok_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">root</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"tokenizer-{vocab_size}.json"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">tok_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu">create_tokenizer</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">content</span><span class="op">)</span>,</span>
<span>        <span class="va">vocab_size</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;fbegin&gt;"</span>, <span class="st">"&lt;fend&gt;"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">root</span><span class="op">)</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">tok</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="va">tok_path</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">tokenizer</span><span class="op">$</span><span class="fu">from_file</span><span class="op">(</span><span class="va">tok_path</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span>,</span>
<span>  .iter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span>    <span class="va">sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">context_length</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">i</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sequence</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>          <span class="va">sequence</span>,</span>
<span>          <span class="va">self</span><span class="op">$</span><span class="va">tok</span><span class="op">$</span><span class="fu">encode</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&lt;fbegin&gt;"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">content</span><span class="op">[</span><span class="va">self</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"&lt;fend&gt;"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">ids</span></span>
<span>        <span class="op">)</span></span>
<span>        <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">context_length</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/iterator.html" class="external-link">exhausted</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">sequence</span> <span class="op">&lt;&lt;-</span> <span class="va">sequence</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">context_length</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        input_ids <span class="op">=</span> <span class="va">sequence</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">context_length</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1L</span>,</span>
<span>        labels <span class="op">=</span> <span class="va">sequence</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">context_length</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># debug code for the dataset</span></span>
<span><span class="co"># ds &lt;- r_sources_dataset("~/Downloads/")</span></span>
<span><span class="co"># it &lt;- ds$.iter()</span></span>
<span><span class="co"># it()</span></span>
<span><span class="co"># ds$tok$get_vocab_size()</span></span></code></pre></div>
<p>This dataset is likely too large for us to train the model on all
documents in this example. It’s also hard to predict how long it will
take for it to train until the end. In order to make it easier, we
define a wraper dataset that is used to run the above dataset for a
fixed number of steps. This is not required, but makes using luz more
pleasant, as we can easily define for how many tokens we want to train
our model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_steps_iterable_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/iterable_dataset.html" class="external-link">iterable_dataset</a></span><span class="op">(</span></span>
<span>  <span class="st">"fixed_steps_dataset"</span>,</span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dataset</span>, <span class="va">steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="va">steps</span></span>
<span>  <span class="op">}</span>,</span>
<span>  .iter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span>    <span class="va">iter</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="va">self</span><span class="op">$</span><span class="va">steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/iterator.html" class="external-link">exhausted</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span> <span class="op">||</span> <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/iterator.html" class="external-link">is_exhausted</a></span><span class="op">(</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">iter</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">iter</span> <span class="op">&lt;&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">dataset</span><span class="op">$</span><span class="fu">.iter</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">iter</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="va">data</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span>,</span>
<span>  .length <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">steps</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We finally define the model we are going to train. We’ll use a small
version of GPT2. We also define a <code>generate</code> method allowing
us to sample from the model given an initial context.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_module.html" class="external-link">nn_module</a></span><span class="op">(</span></span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">gpt</span> <span class="op">&lt;-</span> <span class="fu">minhub</span><span class="fu">::</span><span class="fu">gpt2</span><span class="op">(</span></span>
<span>      vocab_size <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>      pdrop <span class="op">=</span> <span class="fl">0.1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  forward <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="fu">gpt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="fu">transpose</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  generate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">temperature</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">iter</span> <span class="op">=</span> <span class="fl">50</span>, <span class="va">top_k</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># samples from the model givn a context vector.</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">logits</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">forward</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span>,,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">logits</span> <span class="op">&lt;-</span> <span class="va">logits</span><span class="op">/</span><span class="va">temperature</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">ind</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="va">logits</span><span class="op">$</span><span class="fu">topk</span><span class="op">(</span><span class="va">top_k</span><span class="op">)</span></span>
<span>      <span class="va">logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_full_like.html" class="external-link">torch_full_like</a></span><span class="op">(</span><span class="va">logits</span>, <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span><span class="op">$</span><span class="fu">scatter_</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="va">ind</span>, <span class="va">prob</span><span class="op">)</span></span>
<span>      <span class="va">logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nnf_softmax.html" class="external-link">nnf_softmax</a></span><span class="op">(</span><span class="va">logits</span>, dim <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">id_next</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_multinomial.html" class="external-link">torch_multinomial</a></span><span class="op">(</span><span class="va">logits</span>, num_samples <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_cat.html" class="external-link">torch_cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">id_next</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># debug code for the model</span></span>
<span><span class="co"># ds &lt;- torch::dataloader(r_sources_dataset("~/Downloads/"), batch_size = 32)</span></span>
<span><span class="co"># batch &lt;- coro::collect(ds, 1)[[1]]</span></span>
<span><span class="co"># str(batch)</span></span>
<span><span class="co"># m &lt;- net()</span></span>
<span><span class="co"># str(m(batch$input_ids))</span></span></code></pre></div>
<p>To make it easier to inspect training, we will also define a callback
that prints a sample from the model every epoch.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># samples from the model using the context.</span></span>
<span><span class="va">generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">tok</span>, <span class="va">context</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/with_no_grad.html" class="external-link">local_no_grad</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># disables gradient for sampling</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tok</span><span class="op">$</span><span class="fu">encode</span><span class="op">(</span><span class="va">context</span><span class="op">)</span><span class="op">$</span><span class="va">ids</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html" class="external-link">torch_tensor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="cn">NULL</span>,<span class="op">]</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">device</span><span class="op">)</span></span>
<span>  <span class="va">content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="fu">cpu</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tok</span><span class="op">$</span><span class="fu">decode</span><span class="op">(</span><span class="va">content</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">display_cb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/luz_callback.html">luz_callback</a></span><span class="op">(</span></span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>,</span>
<span>  on_epoch_end <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/torch/man/with_no_grad.html" class="external-link">local_no_grad</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co"># sample from the model...</span></span>
<span>    <span class="va">context</span> <span class="op">&lt;-</span> <span class="st">"# creates a linear model"</span></span>
<span>    <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">generate</span><span class="op">(</span><span class="va">ctx</span><span class="op">$</span><span class="va">model</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span><span class="op">$</span><span class="va">tok</span>, <span class="va">context</span>, iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_rule.html" class="external-link">cli_rule</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_rule.html" class="external-link">cli_rule</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can finally train the model. We define that we want to train the
model for half a billion tokens in a total of 100 epochs.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_tokens</span> <span class="op">&lt;-</span> <span class="fl">500e6</span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">16</span></span>
<span><span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">context_length</span> <span class="op">&lt;-</span> <span class="fl">256L</span></span>
<span></span>
<span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="va">n_tokens</span> <span class="op">/</span> <span class="va">context_length</span> <span class="op">/</span> <span class="va">epochs</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu">fixed_steps_iterable_dataset</span><span class="op">(</span></span>
<span>  <span class="fu">r_sources_dataset</span><span class="op">(</span>context_length <span class="op">=</span> <span class="va">context_length</span><span class="op">)</span>,</span>
<span>  steps <span class="op">=</span> <span class="va">steps</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitted</span> <span class="op">&lt;-</span> <span class="va">net</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/setup.html">setup</a></span><span class="op">(</span></span>
<span>    optimizer <span class="op">=</span> <span class="va">optim_adam</span>,</span>
<span>    loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_cross_entropy_loss.html" class="external-link">nn_cross_entropy_loss</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/set_opt_hparams.html">set_opt_hparams</a></span><span class="op">(</span>lr <span class="op">=</span> <span class="fl">3e-4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    <span class="va">dataset</span>,</span>
<span>    epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>    dataloader_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>batch_size <span class="op">=</span> <span class="va">batch_size</span><span class="op">)</span>,</span>
<span>    callbacks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../../reference/luz_callback_lr_scheduler.html">luz_callback_lr_scheduler</a></span><span class="op">(</span></span>
<span>        <span class="fu">torch</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/torch/man/lr_one_cycle.html" class="external-link">lr_one_cycle</a></span>,</span>
<span>        max_lr <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>        epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>        steps_per_epoch <span class="op">=</span> <span class="va">steps</span><span class="op">/</span><span class="va">batch_size</span>,</span>
<span>        call_on <span class="op">=</span> <span class="st">"on_batch_end"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../../reference/luz_callback_gradient_clip.html">luz_callback_gradient_clip</a></span><span class="op">(</span>max_norm <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="fu">display_cb</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">luz</span><span class="fu">::</span><span class="fu"><a href="../../reference/luz_save.html">luz_save</a></span><span class="op">(</span><span class="va">fitted</span>, <span class="st">"model.pt"</span><span class="op">)</span></span></code></pre></div>
<p>We can then use the model to generate text given a prompt with:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu">luz</span><span class="fu">::</span><span class="fu"><a href="../../reference/luz_load.html">luz_load</a></span><span class="op">(</span><span class="st">"model.pt"</span><span class="op">)</span></span>
<span><span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu">tok</span><span class="fu">::</span><span class="va">tokenizer</span><span class="op">$</span><span class="fu">from_file</span><span class="op">(</span><span class="st">"tokenizer-20000.json"</span><span class="op">)</span></span>
<span><span class="va">context</span> <span class="op">&lt;-</span> <span class="st">"#' Creates a linear model</span></span>
<span><span class="st">linear_model &lt;- function(x, y) {</span></span>
<span><span class="st">"</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">generate</span><span class="op">(</span><span class="va">fitted</span><span class="op">$</span><span class="va">model</span>, <span class="va">tok</span>, <span class="va">context</span>, iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Falbel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
